Vagrant.configure("2") do |config|
	config.vm.box = "ubuntu/jammy64"

  # Best practice: desable synced folders if not needed
  config.vm.synced_folder ".", "/vagrant", disabled: true

  SERVER_IP = "192.168.56.110"
  WORKER_IP = "192.168.56.111"

  # Upload common.sh to both machines
  config.vm.provision "file", source: "common.sh", destination: "/home/vagrant/common.sh"

  # Configure global VitualBox settings
  config.vm.provider "virtualbox" do |vb|
	vb.memory = "1024"
	vb.cpus = 2
  end

  username = "bfiguet"

  # MACHINE 1: Server (k3s server / controller)
  config.vm.define "bfiguetS" do |server|
	server.vm.hostname = "bfiguetS"
	server.vm.network "private_network", ip: SERVER_IP
	server.vm.provision "shell", path: "server.sh", args: [SERVER_IP]
  end

  # MACHINE 2: Worker (k3s agent / worker)
  config.vm.define "bfiguetSW" do |worker|
	worker.vm.hostname = "bfiguetSW"
	worker.vm.network "private_network", ip: WORKER_IP
	worker.vm.provision "shell", path: "worker.sh", args: [WORKER_IP]
  end
end
